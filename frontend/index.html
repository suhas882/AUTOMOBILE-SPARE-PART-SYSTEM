<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Shop high-quality automobile spare parts at Maridadi Auto Parts.">
  <meta name="google-site-verification" content="64S_w5si7Ee8aQRoPQvVpqZb14l0EhwhpkmlznVqW28">
  <title>Automobile Spare Part System</title>
  <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.ico">
</head>
<body>
  <div id="root"></div>

  <!-- Load scripts at the end of body -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Initialize EmailJS with your Public Key
    emailjs.init({ publicKey: 'qtJL6k2XF-u71GFXy' });

    // Sample vehicle types
    const vehicleTypes = [
      "Toyota Corolla",
      "Honda Civic",
      "Ford F-150",
      "Nissan Altima",
      "Mitsubishi Lancer",
      "Scania Truck"
    ];

    // Login Component
    function Login({ setIsLoggedIn, setIsAdmin }) {
      const [username, setUsername] = useState("");
      const [password, setPassword] = useState("");
      const [isAdminChecked, setIsAdminChecked] = useState(false);

      const handleLogin = (e) => {
        e.preventDefault();
        if (username === 'admin' && password === 'admin123' && isAdminChecked) {
          sessionStorage.setItem('isLoggedIn', 'true');
          sessionStorage.setItem('isAdmin', 'true');
          sessionStorage.setItem('username', username);
          setIsLoggedIn(true);
          setIsAdmin(true);
        } else if (username === 'user' && password === 'user123' && !isAdminChecked) {
          sessionStorage.setItem('isLoggedIn', 'true');
          sessionStorage.setItem('isAdmin', 'false');
          sessionStorage.setItem('username', username);
          setIsLoggedIn(true);
          setIsAdmin(false);
        } else {
          alert('Invalid credentials or incorrect admin status');
        }
      };

      return (
        <div className="bg-gray-100 flex items-center justify-center min-h-screen">
          <div className="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
            <h2 className="text-2xl font-bold mb-6 text-center">Login</h2>
            <form onSubmit={handleLogin}>
              <div className="mb-4">
                <label htmlFor="username" className="block text-sm font-medium text-gray-700">Username</label>
                <input
                  type="text"
                  id="username"
                  value={username}
                  onChange={(e) => setUsername(e.target.value)}
                  className="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  required
                />
              </div>
              <div className="mb-6">
                <label htmlFor="password" className="block text-sm font-medium text-gray-700">Password</label>
                <input
                  type="password"
                  id="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  required
                />
              </div>
              <div className="mb-4">
                <label className="inline-flex items-center">
                  <input
                    type="checkbox"
                    checked={isAdminChecked}
                    onChange={(e) => setIsAdminChecked(e.target.checked)}
                    className="form-checkbox h-5 w-5 text-blue-600"
                  />
                  <span className="ml-2 text-sm text-gray-700">Login as Admin</span>
                </label>
              </div>
              <button
                type="submit"
                className="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded"
              >
                Login
              </button>
            </form>
          </div>
        </div>
      );
    }

    // Header Component
    function Header({ cartItems, setCartOpen, setCurrentPage, isAdmin, newOrderCount }) {
      return (
        <header className="bg-gray-800 text-white sticky top-0 z-10">
          <div className="container mx-auto flex justify-between items-center py-4 px-4">
            <div className="logo">
              <a href="#">
                <img src="https://dcassetcdn.com/design_img/2793673/484367/484367_15258317_2793673_cf010444_image.png" alt="Automobile Spare Part System" className="h-12" />
              </a>
            </div>
            <nav className="hidden md:flex space-x-6">
              <a href="#" onClick={() => setCurrentPage('home')} className="hover:text-gray-300">Home</a>
              <a href="team.html" className="hover:text-gray-300">Team of Mechanics</a>
              <a href="distributors.html" className="hover:text-gray-300">Distributors</a>
              <a href="contact.html" className="hover:text-gray-300">Contact</a>
              {!isAdmin && (
                <a
                  href="#"
                  onClick={() => setCurrentPage('orders')}
                  className="hover:text-gray-300"
                >
                  Order History
                </a>
              )}
              {isAdmin && (
                <a
                  href="#"
                  onClick={() => setCurrentPage('admin')}
                  className="relative bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded"
                >
                  Admin Panel
                  {newOrderCount > 0 && (
                    <span className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full px-2 text-xs">{newOrderCount}</span>
                  )}
                </a>
              )}
            </nav>
            <div className="flex items-center space-x-4">
              <div className="text-sm hidden md:block">
                <p>hi near chennai</p>
                <p><a href="tel:+12345466778">+12345466778</a></p>
              </div>
              <button onClick={() => setCartOpen(true)} className="relative">
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                {cartItems.length > 0 && (
                  <span className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full px-2 text-xs">{cartItems.length}</span>
                )}
              </button>
              <button onClick={() => logout()} className="bg-red-500 hover:bg-red-600 px-4 py-2 rounded hidden md:block">Logout</button>
              <button className="md:hidden" onClick={() => document.getElementById('mobile-menu').classList.toggle('hidden')}>
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
              </button>
            </div>
          </div>
          <div id="mobile-menu" className="hidden md:hidden bg-gray-700 px-4 py-2">
            <nav className="flex flex-col space-y-2">
              <a href="#" onClick={() => setCurrentPage('home')} className="hover:text-gray-300">Home</a>
              <a href="#" className="hover:text-gray-300">Team of Mechanics</a>
              <a href="distributors.html" className="hover:text-gray-300">Distributors</a>
              <a href="#" className="hover:text-gray-300">Contact</a>
              {!isAdmin && (
                <a
                  href="#"
                  onClick={() => setCurrentPage('orders')}
                  className="hover:text-gray-300"
                >
                  Order History
                </a>
              )}
              {isAdmin && (
                <a
                  href="#"
                  onClick={() => setCurrentPage('admin')}
                  className="relative bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded"
                >
                  Admin Panel
                  {newOrderCount > 0 && (
                    <span className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full px-2 text-xs">{newOrderCount}</span>
                  )}
                </a>
              )}
              <p className="text-sm">hi near chennai</p>
              <p className="text-sm"><a href="tel:+12345466778">+12345466778</a></p>
              <button onClick={() => logout()} className="bg-red-500 hover:bg-red-600 px-4 py-2 rounded w-full text-left">Logout</button>
            </nav>
          </div>
        </header>
      );
    }

    // Vehicle Selection Modal Component
    function VehicleModal({ isOpen, setIsOpen, product, addToCart }) {
      const [selectedVehicle, setSelectedVehicle] = useState("");

      const handleAddToCart = () => {
        if (selectedVehicle) {
          addToCart({ ...product, vehicle: selectedVehicle });
          setIsOpen(false);
          setSelectedVehicle("");
        } else {
          alert("Please select a vehicle type");
        }
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20">
          <div className="bg-white p-6 rounded-lg max-w-md w-full">
            <h2 className="text-xl font-bold mb-4">Select Vehicle for {product.name}</h2>
            <select
              className="w-full p-2 border rounded mb-4"
              value={selectedVehicle}
              onChange={(e) => setSelectedVehicle(e.target.value)}
            >
              <option value="">Select a vehicle</option>
              {vehicleTypes.map((vehicle, index) => (
                <option key={index} value={vehicle}>{vehicle}</option>
              ))}
            </select>
            <div className="flex justify-end space-x-2">
              <button
                onClick={() => setIsOpen(false)}
                className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded"
              >
                Cancel
              </button>
              <button
                onClick={handleAddToCart}
                className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
              >
                Add to Cart
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Product Card Component
    function ProductCard({ product, setSelectedProduct, setVehicleModalOpen }) {
      return (
        <div className="bg-white shadow-md rounded-lg overflow-hidden">
          <img src={product.image} alt={product.name} className="w-full h-48 object-cover" />
          <div className="p-4">
            <h3 className="text-lg font-semibold">{product.name}</h3>
            <p className="text-gray-600">${product.price}</p>
            <button
              onClick={() => {
                setSelectedProduct(product);
                setVehicleModalOpen(true);
              }}
              className="mt-2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full"
            >
              Add to Cart
            </button>
          </div>
        </div>
      );
    }

    // Cart Modal Component
    function CartModal({ cartItems, setCartOpen, onProceedToDetails }) {
      const handleProceedToDetails = () => {
        if (cartItems.length === 0) {
          alert("Cart is empty!");
          return;
        }
        onProceedToDetails();
        setCartOpen(false);
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20">
          <div className="bg-white p-6 rounded-lg max-w-md w-full">
            <h2 className="text-xl font-bold mb-4">Your Cart</h2>
            {cartItems.length === 0 ? (
              <p>Your cart is empty.</p>
            ) : (
              <ul className="space-y-2">
                {cartItems.map((item, index) => (
                  <li key={index} className="flex justify-between">
                    <span>{item.name} ({item.vehicle})</span>
                    <span>${item.price}</span>
                  </li>
                ))}
              </ul>
            )}
            <div className="mt-4 flex justify-end space-x-2">
              <button
                onClick={() => setCartOpen(false)}
                className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded"
              >
                Close
              </button>
              {cartItems.length > 0 && (
                <button
                  onClick={handleProceedToDetails}
                  className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded"
                >
                  Proceed to Details
                </button>
              )}
            </div>
          </div>
        </div>
      );
    }

    // User Details Modal Component
    function UserDetailsModal({ isOpen, setIsOpen, cartItems, onConfirmOrder }) {
      const [userDetails, setUserDetails] = useState({
        name: "",
        email: "",
        phone: "",
        address: ""
      });
      const [emailError, setEmailError] = useState("");

      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setUserDetails(prev => ({ ...prev, [name]: value }));
        if (name === 'email') {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          setEmailError(emailRegex.test(value) ? "" : "Please enter a valid email address");
        }
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!userDetails.name || !userDetails.email || !userDetails.phone || !userDetails.address) {
          alert("Please fill in all required fields");
          return;
        }
        if (emailError) {
          alert("Please correct the email address");
          return;
        }
        onConfirmOrder(userDetails);
        setIsOpen(false);
        setUserDetails({ name: "", email: "", phone: "", address: "" });
        setEmailError("");
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20">
          <div className="bg-white p-6 rounded-lg max-w-md w-full">
            <h2 className="text-xl font-bold mb-4">Enter Your Details</h2>
            <p className="text-sm text-gray-600 mb-4">You will receive email notifications for order updates.</p>
            <form onSubmit={handleSubmit}>
              <div className="mb-4">
                <label htmlFor="name" className="block text-sm font-medium text-gray-700">Full Name</label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  value={userDetails.name}
                  onChange={handleInputChange}
                  className="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  required
                />
              </div>
              <div className="mb-4">
                <label htmlFor="email" className="block text-sm font-medium text-gray-700">Email</label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  value={userDetails.email}
                  onChange={handleInputChange}
                  className={`mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 ${
                    emailError ? 'border-red-500 focus:ring-red-500' : 'focus:ring-blue-500'
                  }`}
                  required
                />
                {emailError && <p className="text-red-500 text-sm mt-1">{emailError}</p>}
              </div>
              <div className="mb-4">
                <label htmlFor="phone" className="block text-sm font-medium text-gray-700">Phone Number</label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  value={userDetails.phone}
                  onChange={handleInputChange}
                  className="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  required
                />
              </div>
              <div className="mb-4">
                <label htmlFor="address" className="block text-sm font-medium text-gray-700">Delivery Address</label>
                <textarea
                  id="address"
                  name="address"
                  value={userDetails.address}
                  onChange={handleInputChange}
                  className="mt-1 p-2 w-full border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                  required
                />
              </div>
              <div className="flex justify-end space-x-2">
                <button
                  type="button"
                  onClick={() => setIsOpen(false)}
                  className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded"
                >
                  Confirm Order
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    // Order Tracking Component
    function OrderTracking({ order, setCurrentPage }) {
      if (!order) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <p className="text-xl text-red-500">Order not found.</p>
          </div>
        );
      }

      const statuses = ['Placed', 'Processing', 'Shipped', 'Delivered'];
      const currentStatusIndex = statuses.indexOf(order.status);

      return (
        <div className="min-h-screen bg-gray-100 py-8">
          <div className="container mx-auto px-4">
            <h2 className="text-3xl font-bold mb-8">Track Order #{order.id}</h2>
            <div className="bg-white p-6 rounded-lg shadow-md">
              <h3 className="text-xl font-semibold mb-4">Order Status</h3>
              <div className="relative mb-6">
                <div className="flex justify-between items-center">
                  {statuses.map((status, index) => (
                    <div key={status} className="flex-1 text-center">
                      <div
                        className={`w-8 h-8 mx-auto rounded-full flex items-center justify-center ${
                          index <= currentStatusIndex
                            ? 'bg-green-500 text-white'
                            : 'bg-gray-300 text-gray-700'
                        }`}
                      >
                        {index + 1}
                      </div>
                      <p
                        className={`mt-2 text-sm ${
                          index <= currentStatusIndex ? 'font-semibold text-green-600' : 'text-gray-600'
                        }`}
                      >
                        {status}
                      </p>
                    </div>
                  ))}
                </div>
                <div className="absolute top-3 left-0 right-0 h-1 bg-gray-300">
                  <div
                    className="h-1 bg-green-500"
                    style={{ width: `${(currentStatusIndex / (statuses.length - 1)) * 100}%` }}
                  ></div>
                </div>
              </div>
              <div className="mt-4">
                <p className="font-semibold">Order ID: {order.id}</p>
                <p className="text-sm text-gray-600">Placed on: {order.date}</p>
                {order.deliveryMessage && (
                  <p className="text-sm text-green-600">Delivery: {order.deliveryMessage}</p>
                )}
                {order.userDetails && (
                  <div className="mt-2">
                    <p><strong>Your Details:</strong></p>
                    <p>Name: {order.userDetails.name}</p>
                    <p>Email: {order.userDetails.email}</p>
                    <p>Phone: {order.userDetails.phone}</p>
                    <p>Address: {order.userDetails.address}</p>
                  </div>
                )}
                <ul className="mt-2 space-y-1">
                  {order.items.map((item, index) => (
                    <li key={index} className="flex justify-between">
                      <span>{item.name} ({item.vehicle})</span>
                      <span>${item.price}</span>
                    </li>
                  ))}
                </ul>
              </div>
            </div>
            <button
              onClick={() => setCurrentPage('orders')}
              className="mt-6 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
            >
              Back to Orders
            </button>
          </div>
        </div>
      );
    }

    // User Orders Component
    function UserOrders({ orders, username, setCurrentPage }) {
      const userOrders = orders.filter(order => order.username === username);

      return (
        <div className="min-h-screen bg-gray-100 py-8">
          <div className="container mx-auto px-4">
            <h2 className="text-3xl font-bold mb-8">Your Order History</h2>
            {userOrders.length === 0 ? (
              <p className="text-lg">You have no orders yet.</p>
            ) : (
              <div className="space-y-4">
                {userOrders.map((order) => (
                  <div
                    key={order.id}
                    className="bg-white p-4 border rounded shadow-md"
                  >
                    <div className="flex justify-between items-center">
                      <div>
                        <p className="font-semibold">Order ID: {order.id}</p>
                        <p className="text-sm text-gray-600">Placed on: {order.date}</p>
                        <p className="text-sm text-gray-600">Status: {order.status}</p>
                        {order.deliveryMessage && (
                          <p className="text-sm text-green-600">
                            Delivery: {order.deliveryMessage}
                          </p>
                        )}
                      </div>
                      <button
                        onClick={() => setCurrentPage('tracking', { orderId: order.id })}
                        className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded"
                      >
                        Track Order
                      </button>
                    </div>
                    {order.userDetails && (
                      <div className="mt-2">
                        <p><strong>Your Details:</strong></p>
                        <p>Name: {order.userDetails.name}</p>
                        <p>Email: {order.userDetails.email}</p>
                        <p>Phone: {order.userDetails.phone}</p>
                        <p>Address: {order.userDetails.address}</p>
                      </div>
                    )}
                    <ul className="mt-2 space-y-1">
                      {order.items.map((item, index) => (
                        <li key={index} className="flex justify-between">
                          <span>{item.name} ({item.vehicle})</span>
                          <span>${item.price}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                ))}
              </div>
            )}
            <button
              onClick={() => setCurrentPage('home')}
              className="mt-6 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
            >
              Back to Home
            </button>
          </div>
        </div>
      );
    }

    // Admin Orders Component
    function AdminOrders({ orders, setOrders, setNewOrderCount }) {
      const handleMarkAsRead = (orderId) => {
        const updatedOrders = orders.map(order =>
          order.id === orderId ? { ...order, read: true } : order
        );
        setOrders(updatedOrders);
        localStorage.setItem('orders', JSON.stringify(updatedOrders));
        setNewOrderCount(updatedOrders.filter(order => !order.read).length);
      };

      const handleUpdateStatus = (orderId, newStatus) => {
        console.log(`Updating status for order ${orderId} to ${newStatus}`);
        const updatedOrders = orders.map(order => {
          if (order.id === orderId) {
            const deliveryMessage = ['Shipped', 'Delivered'].includes(newStatus)
              ? 'Deliverable within 2-3 days'
              : '';
            return { ...order, status: newStatus, read: true, deliveryMessage };
          }
          return order;
        });
        setOrders(updatedOrders);
        localStorage.setItem('orders', JSON.stringify(updatedOrders));
        setNewOrderCount(updatedOrders.filter(order => !order.read).length);

        // Send status update email
        const order = updatedOrders.find(o => o.id === orderId);
        if (order.userDetails && order.userDetails.email) {
          const params = {
            to_email: order.userDetails.email,
            to_name: order.userDetails.name,
            order_id: order.id,
            new_status: newStatus,
            delivery_message: order.deliveryMessage || '',
            portal_link: 'http://localhost:8080'
          };
          console.log('Sending status update email with params:', params);
          emailjs.send('service_x5ngvmb', 'template_7prkzq9', params)
            .then(() => console.log(`Status update email sent for order ${orderId}`))
            .catch(error => console.error('Error sending status update email:', error));
        } else {
          console.warn('No email found for order:', orderId);
        }

        alert(`Order status updated to ${newStatus}!`);
      };

      useEffect(() => {
        console.log('AdminOrders rendered with orders:', orders);
      }, [orders]);

      return (
        <div className="bg-white p-6 rounded-lg shadow-md">
          <h3 className="text-xl font-semibold mb-4">Order History</h3>
          {orders.length === 0 ? (
            <p>No orders yet.</p>
          ) : (
            <div className="space-y-4">
              {orders.map((order) => (
                <div
                  key={order.id}
                  className={`p-4 border rounded ${order.read ? 'bg-gray-100' : 'bg-yellow-50'}`}
                >
                  <div className="flex justify-between items-center">
                    <div>
                      <p className="font-semibold">Order ID: {order.id}</p>
                      <p className="text-sm text-gray-600">Placed on: {order.date}</p>
                      <p className="text-sm text-gray-600">Status: {order.status}</p>
                      {order.deliveryMessage && (
                        <p className="text-sm text-green-600">
                          Delivery: {order.deliveryMessage}
                        </p>
                      )}
                    </div>
                    <div className="flex space-x-2">
                      {!order.read && (
                        <button
                          onClick={() => handleMarkAsRead(order.id)}
                          className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded"
                        >
                          Mark as Read
                        </button>
                      )}
                      <select
                        value={order.status}
                        onChange={(e) => handleUpdateStatus(order.id, e.target.value)}
                        className="border rounded p-1 text-sm"
                      >
                        {['Placed', 'Processing', 'Shipped', 'Delivered'].map(status => (
                          <option key={status} value={status}>{status}</option>
                        ))}
                      </select>
                    </div>
                  </div>
                  {order.userDetails && (
                    <div className="mt-2">
                      <p><strong>Customer Details:</strong></p>
                      <p>Name: {order.userDetails.name}</p>
                      <p>Email: {order.userDetails.email}</p>
                      <p>Phone: {order.userDetails.phone}</p>
                      <p>Address: {order.userDetails.address}</p>
                    </div>
                  )}
                  <ul className="mt-2 space-y-1">
                    {order.items.map((item, index) => (
                      <li key={index} className="flex justify-between">
                        <span>{item.name} ({item.vehicle})</span>
                        <span>${item.price}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // Admin Panel Component
    function AdminPanel({ products, setProducts, setCurrentPage, orders, setOrders, newOrderCount, setNewOrderCount }) {
      const [newProduct, setNewProduct] = useState({ name: "", price: "", image: "" });
      const [editingProduct, setEditingProduct] = useState(null);
      const [view, setView] = useState('orders'); // Default to orders view

      const handleAddProduct = () => {
        if (newProduct.name && newProduct.price && newProduct.image) {
          const product = {
            id: products.length + 1,
            name: newProduct.name,
            price: parseFloat(newProduct.price),
            image: newProduct.image
          };
          setProducts([...products, product]);
          setNewProduct({ name: "", price: "", image: "" });
          alert("Product added successfully!");
        } else {
          alert("Please fill all fields");
        }
      };

      const handleEditProduct = (product) => {
        setEditingProduct(product);
      };

      const handleUpdateProduct = () => {
        if (editingProduct.name && editingProduct.price && editingProduct.image) {
          setProducts(
            products.map((p) =>
              p.id === editingProduct.id ? { ...editingProduct } : p
            )
          );
          setEditingProduct(null);
          alert("Product updated successfully!");
        } else {
          alert("Please fill all fields");
        }
      };

      const handleDeleteProduct = (id) => {
        if (window.confirm("Are you sure you want to delete this product?")) {
          setProducts(products.filter((p) => p.id !== id));
          alert("Product deleted successfully!");
        }
      };

      return (
        <div className="min-h-screen bg-gray-100 py-8">
          <div className="container mx-auto px-4">
            <div className="flex justify-between items-center mb-8">
              <h2 className="text-3xl font-bold">Admin Panel</h2>
              <button
                onClick={() => setCurrentPage('home')}
                className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
              >
                Back to Shop
              </button>
            </div>
            <div className="mb-6">
              <button
                onClick={() => setView('products')}
                className={`mr-4 px-4 py-2 rounded ${view === 'products' ? 'bg-yellow-400' : 'bg-gray-300'}`}
              >
                Manage Products
              </button>
              <button
                onClick={() => setView('orders')}
                className={`px-4 py-2 rounded ${view === 'orders' ? 'bg-yellow-400' : 'bg-gray-300'}`}
              >
                View Orders {newOrderCount > 0 && `(${newOrderCount} new)`}
              </button>
            </div>

            {view === 'products' ? (
              <>
                <div className="bg-white p-6 rounded-lg shadow-md mb-8">
                  <h3 className="text-xl font-semibold mb-4">
                    {editingProduct ? "Edit Product" : "Add New Product"}
                  </h3>
                  <div className="grid grid-cols-1 gap-4">
                    <input
                      type="text"
                      placeholder="Product Name"
                      value={editingProduct ? editingProduct.name : newProduct.name}
                      onChange={(e) =>
                        editingProduct
                          ? setEditingProduct({ ...editingProduct, name: e.target.value })
                          : setNewProduct({ ...newProduct, name: e.target.value })
                      }
                      className="p-2 border rounded w-full"
                    />
                    <input
                      type="number"
                      placeholder="Price"
                      value={editingProduct ? editingProduct.price : newProduct.price}
                      onChange={(e) =>
                        editingProduct
                          ? setEditingProduct({ ...editingProduct, price: e.target.value })
                          : setNewProduct({ ...newProduct, price: e.target.value })
                      }
                      className="p-2 border rounded w-full"
                    />
                    <input
                      type="text"
                      placeholder="Image URL"
                      value={editingProduct ? editingProduct.image : newProduct.image}
                      onChange={(e) =>
                        editingProduct
                          ? setEditingProduct({ ...editingProduct, image: e.target.value })
                          : setNewProduct({ ...newProduct, image: e.target.value })
                      }
                      className="p-2 border rounded w-full"
                    />
                    <div>
                      {editingProduct ? (
                        <>
                          <button
                            onClick={handleUpdateProduct}
                            className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mr-2"
                          >
                            Update Product
                          </button>
                          <button
                            onClick={() => setEditingProduct(null)}
                            className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded"
                          >
                            Cancel
                          </button>
                        </>
                      ) : (
                        <button
                          onClick={handleAddProduct}
                          className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
                        >
                          Add Product
                        </button>
                      )}
                    </div>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  {products.map((product) => (
                    <div key={product.id} className="bg-gray-100 p-4 rounded shadow">
                      <img src={product.image} alt={product.name} className="w-full h-40 object-cover rounded" />
                      <h4 className="text-lg font-semibold mt-2">{product.name}</h4>
                      <p className="text-gray-700">${product.price}</p>
                      <div className="mt-2 flex space-x-2">
                        <button
                          onClick={() => handleEditProduct(product)}
                          className="bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded"
                        >
                          Edit
                        </button>
                        <button
                          onClick={() => handleDeleteProduct(product.id)}
                          className="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded"
                        >
                          Delete
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </>
            ) : (
              <AdminOrders orders={orders} setOrders={setOrders} setNewOrderCount={setNewOrderCount} />
            )}
          </div>
        </div>
      );
    }

    // Main App Component
    function App() {
      const [isLoggedIn, setIsLoggedIn] = useState(!!sessionStorage.getItem('isLoggedIn'));
      const [isAdmin, setIsAdmin] = useState(sessionStorage.getItem('isAdmin') === 'true');
      const [username, setUsername] = useState(sessionStorage.getItem('username') || '');
      const [cartItems, setCartItems] = useState([]);
      const [cartOpen, setCartOpen] = useState(false);
      const [vehicleModalOpen, setVehicleModalOpen] = useState(false);
      const [userDetailsModalOpen, setUserDetailsModalOpen] = useState(false);
      const [selectedProduct, setSelectedProduct] = useState(null);
      const [currentPage, setCurrentPage] = useState('home');
      const [pageProps, setPageProps] = useState({});
      const [orders, setOrders] = useState(() => {
        const savedOrders = localStorage.getItem('orders');
        const parsedOrders = savedOrders ? JSON.parse(savedOrders) : [];
        console.log('Initial orders loaded:', parsedOrders);
        return parsedOrders;
      });
      const [newOrderCount, setNewOrderCount] = useState(() => {
        const savedOrders = localStorage.getItem('orders');
        const orders = savedOrders ? JSON.parse(savedOrders) : [];
        return orders.filter(order => !order.read).length;
      });

      // Polling for order updates
      useEffect(() => {
        const interval = setInterval(() => {
          const savedOrders = localStorage.getItem('orders');
          if (savedOrders) {
            const updatedOrders = JSON.parse(savedOrders);
            setOrders(updatedOrders);
            setNewOrderCount(updatedOrders.filter(order => !order.read).length);
            console.log('Polled orders:', updatedOrders);
          }
        }, 2000); // Check every 2 seconds
        return () => clearInterval(interval);
      }, []);

      const [products, setProducts] = useState([
        {
          id: 1,
          name: "Brake Pads",
          price: 1200,
          image: "https://th.bing.com/th/id/R.2375ea09c0bcbfd888030c50c35c232b?rik=%2f%2bI%2ftEszNE1e8g&riu=http%3a%2f%2facdelcocanada.com%2ffiles%2flarge%2f1d3da303c94cc6c&ehk=57%2bEkmenI09Cik9HlDLOFQyncjWuBw1jpv6jXlAFL2s%3d&risl=&pid=ImgRaw&r=0"
        },
        {
          id: 2,
          name: "Oil Filter",
          price: 12.99,
          image: "https://www.carparts.com/blog/wp-content/uploads/2023/07/car-spin-on-and-cartridge-type-of-oil-filter.jpg"
        },
        {
          id: 3,
          name: "Air Filter",
          price: 18.99,
          image: "https://www.carparts.com/blog/wp-content/uploads/2020/08/replacing-air-filter.jpeg"
        },
        {
          id: 4,
          name: "Spark Plugs",
          price: 8.99,
          image: "https://tse2.mm.bing.net/th/id/OIP.LSI9UBAhxgE9Gk522XejHQHaE8?rs=1&pid=ImgDetMain"
        },
        {
          id: 5,
          name: "Battery",
          price: 4500,
          image: "https://static.carfromjapan.com/wp-content/uploads/2020/12/074ccc887859a353f7c1ef5cde6b7810.jpeg"
        },
        {
          id: 6,
          name: "Tire Set",
          price: 399.99,
          image: "https://www.tirerack.com/content/dam/tirerack/desktop/Open_Graph_Images/og_TireWheelPkg.jpg"
        }
      ]);
        
      const handleProceedToDetails = () => {
        setUserDetailsModalOpen(true);
      };

      const handleConfirmOrder = (userDetails) => {
        if (cartItems.length === 0) {
          alert("Cart is empty!");
          return;
        }
        const newOrder = {
          id: Date.now(),
          items: cartItems,
          userDetails,
          username,
          date: new Date().toLocaleString(),
          read: false,
          status: 'Placed',
          deliveryMessage: ''
        };
        const updatedOrders = [...orders, newOrder];
        setOrders(updatedOrders);
        localStorage.setItem('orders', JSON.stringify(updatedOrders));
        setNewOrderCount(updatedOrders.filter(order => !order.read).length);
        setCartItems([]);
        alert("Order placed successfully!");

        // Send order confirmation email
        if (userDetails.email) {
          const itemsList = cartItems.map(item => `${item.name} (${item.vehicle}) - $${item.price}`).join('<br>');
          const params = {
            to_email: userDetails.email,
            to_name: userDetails.name,
            order_id: newOrder.id,
            order_status: newOrder.status,
            order_date: newOrder.date,
            items: itemsList,
            user_name: userDetails.name,
            user_email: userDetails.email,
            user_phone: userDetails.phone,
            user_address: userDetails.address
          };
          console.log('Sending confirmation email with params:', params);
          emailjs.send('service_x5ngvmb', 'template_wx2o3tf', params)
            .then(() => console.log('Order confirmation email sent'))
            .catch(error => console.error('Error sending confirmation email:', error));
        }
      };

      const addToCart = (product) => {
        setCartItems([...cartItems, product]);
      };

      const navigate = (page, props = {}) => {
        setCurrentPage(page);
        setPageProps(props);
      };

      if (!isLoggedIn) {
        return <Login setIsLoggedIn={setIsLoggedIn} setIsAdmin={setIsAdmin} />;
      }

      return (
        <div className="min-h-screen flex flex-col">
          {currentPage === 'home' ? (
            <>
              <Header
                cartItems={cartItems}
                setCartOpen={setCartOpen}
                setCurrentPage={navigate}
                isAdmin={isAdmin}
                newOrderCount={newOrderCount}
              />
              {cartOpen && (
                <CartModal
                  cartItems={cartItems}
                  setCartOpen={setCartOpen}
                  onProceedToDetails={handleProceedToDetails}
                />
              )}
              <VehicleModal
                isOpen={vehicleModalOpen}
                setIsOpen={setVehicleModalOpen}
                product={selectedProduct}
                addToCart={addToCart}
              />
              <UserDetailsModal
                isOpen={userDetailsModalOpen}
                setIsOpen={setUserDetailsModalOpen}
                cartItems={cartItems}
                onConfirmOrder={handleConfirmOrder}
              />

              <section className="bg-gray-100 py-16">
                <div className="container mx-auto px-4 text-center">
                  <h1 className="text-4xl md:text-5xl font-bold mb-4">Automobile Spare Part System</h1>
                  <p className="text-lg mb-6">Find reliable parts for all vehicle types at Automobile Spare Part System.</p>
                </div>
              </section>

              <section className="py-16">
                <div className="container mx-auto px-4">
                  <h2 className="text-3xl font-bold text-center mb-8">Our Products</h2>
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    {products.map((product) => (
                      <ProductCard
                        key={product.id}
                        product={product}
                        setSelectedProduct={setSelectedProduct}
                        setVehicleModalOpen={setVehicleModalOpen}
                      />
                    ))}
                  </div>
                </div>
              </section>

              <section className="py-16 bg-gray-50">
                <div className="container mx-auto px-4">
                  <h2 className="text-3xl font-bold text-center mb-8">Trusted Brands</h2>
                  <div className="flex overflow-x-auto space-x-4">
                    {[
                      { src: "https://th.bing.com/th/id/OIP.V9csKwCk6clNFasBbWV-FwHaEK?rs=1&pid=ImgDetMain", alt: "Toyota" },
                      { src: "https://th.bing.com/th/id/OIP.fXl4H4tF8T9kJ_Lsh-tQNgHaGo?rs=1&pid=ImgDetMain", alt: "Nissan" },
                      { src: "https://i.pinimg.com/originals/c7/de/c1/c7dec1611c58aa8d5afd2ac089de828f.jpg", alt: "Fuso" },
                      { src: "https://logos-world.net/wp-content/uploads/2020/12/Hero-Logo.png", alt: "Hero" },
                    ].map((brand, index) => (
                      <img key={index} src={brand.src} alt={brand.alt} className="h-16 object-contain" />
                    ))}
                  </div>
                </div>
              </section>

              <footer className="bg-gray-800 text-white py-8">
                <div className="container mx-auto px-4 text-center">
                  <p className="mt-2">hi near chennai | <a href="tel:+12345466778">+12345466778</a></p>
                  <a href="https://wa.me/qr/6WXVUMTMIOQYM1" target="_blank" rel="noopener noreferrer" className="inline-block mt-2">
                    <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.198-.347.223-.644.075-.297-.148-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.134.297-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.074-.149-.669-.719-.889-.986-.219-.267-.422-.487-.669-.487-.246 0-.492.074-.689.321-.198.247-.815.925-.985 2.23-.173 1.305.998 2.508 1.146 2.656.149.149 2.094 3.2 5.078 4.487.709.307 1.263.489 1.694.572.431.083.892.057 1.295-.099.39-.149 1.203-.497 1.376-.796.173-.297.173-.647.074-.796-.099-.149-.297-.297-.594-.446zM12 0C5.373 0 0 5.373 0 12c0 2.118.551 4.115 1.508 5.873L0 24l6.282-1.645A11.944 11.944 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0z" />
                    </svg>
                  </a>
                </div>
              </footer>

              <a href="#" className="fixed bottom-4 right-4 bg-blue-500 text-white p-2 rounded-full">
                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 15l7-7 7 7" />
                </svg>
              </a>
            </>
          ) : currentPage === 'admin' ? (
            isAdmin ? (
              <AdminPanel
                products={products}
                setProducts={setProducts}
                setCurrentPage={navigate}
                orders={orders}
                setOrders={setOrders}
                newOrderCount={newOrderCount}
                setNewOrderCount={setNewOrderCount}
              />
            ) : (
              <div className="min-h-screen flex items-center justify-center">
                <p className="text-xl text-red-500">Access Denied: Admin privileges required.</p>
              </div>
            )
          ) : currentPage === 'orders' ? (
            !isAdmin ? (
              <UserOrders orders={orders} username={username} setCurrentPage={navigate} />
            ) : (
              <div className="min-h-screen flex items-center justify-center">
                <p className="text-xl text-red-500">Access Denied: Only non-admin users can view order history.</p>
              </div>
            )
          ) : currentPage === 'tracking' ? (
            !isAdmin ? (
              <OrderTracking
                order={orders.find(order => order.id === pageProps.orderId)}
                setCurrentPage={navigate}
              />
            ) : (
              <div className="min-h-screen flex items-center justify-center">
                <p className="text-xl text-red-500">Access Denied: Only non-admin users can track orders.</p>
              </div>
            )
          ) : (
            <div className="min-h-screen flex items-center justify-center">
              <p className="text-xl">Shop Page Content Here</p>
            </div>
          )}
        </div>
      );
    }

    // Logout Function
    function logout() {
      sessionStorage.removeItem('isLoggedIn');
      sessionStorage.removeItem('isAdmin');
      sessionStorage.removeItem('username');
      window.location.reload();
    }

    // Render App with enhanced error handling
    try {
      ReactDOM.render(<App />, document.getElementById('root'));
    } catch (e) {
      console.error("React render error:", e);
      document.getElementById('root').innerHTML = `
        <div style="padding: 20px; color: red; font-family: Arial;">
          <h2>Application Error</h2>
          <p>An error occurred while rendering the application:</p>
          <p><strong>${e.message}</strong></p>
          <p>Please check the browser console (F12 > Console) for more details.</p>
          <p>Common fixes:</p>
          <ul style="list-style-type: disc; margin-left: 20px;">
            <li>Ensure you have an active internet connection for CDN scripts.</li>
            <li>Clear browser cache and refresh the page.</li>
            <li>Check for syntax errors in the code.</li>
          </ul>
        </div>
      `;
    }
  </script>
</body>
</html>
